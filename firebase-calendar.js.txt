// === Firebase SDK imports ===
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

// === Firebase configuration ===
const firebaseConfig = {
  apiKey: "AIzaSyBuN5dn_PNC37CbiaRaQRx78gds6f-JXbI",
  authDomain: "smallvillagerani.firebaseapp.com",
  projectId: "smallvillagerani",
  storageBucket: "smallvillagerani.firebasestorage.app",
  messagingSenderId: "762742575521",
  appId: "1:762742575521:web:0fbd4b3bd62caafe013be0"
};

// === Initialize Firebase ===
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// === Add event to Firestore ===
async function addEvent(title, date) {
  try {
    await addDoc(collection(db, "calendarEvents"), {
      title: title,
      date: date
    });
    console.log("✅ Event added successfully!");
  } catch (error) {
    console.error("❌ Error adding event: ", error);
  }
}

// === Load events from Firestore ===
async function loadEvents() {
  const querySnapshot = await getDocs(collection(db, "calendarEvents"));
  const events = [];
  querySnapshot.forEach((doc) => {
    events.push({ id: doc.id, ...doc.data() });
  });
  console.log("📅 Loaded events:", events);
  return events;
}

// === Render FullCalendar ===
async function renderCalendar() {
  const events = await loadEvents();

  const calendarEl = document.getElementById("calendar");

  if (!calendarEl) {
    console.error("❌ Calendar container not found (add <div id='calendar'></div> in your HTML)");
    return;
  }

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: "dayGridMonth",
    events: events.map(e => ({
      title: e.title,
      start: e.date
    })),
    selectable: true,
    select: async function (info) {
      const title = prompt("Πληκτρολόγησε τίτλο για το γεγονός:");
      if (title) {
        await addEvent(title, info.startStr);
        calendar.addEvent({ title: title, start: info.startStr });
      }
    },
    eventColor: "#0d9488", // όμορφο teal χρώμα
    headerToolbar: {
      left: "prev,next today",
      center: "title",
      right: "dayGridMonth,timeGridWeek,timeGridDay"
    }
  });

  calendar.render();
}

// === Load calendar when page loads ===
window.addEventListener("DOMContentLoaded", renderCalendar);
